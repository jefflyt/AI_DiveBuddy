# Step 3.2.4: Add Certification Progress Badge Display

**Part of:** PR 3.2 - Education Mode & Topic Navigation  
**Focus:** Visual progress tracking with badges and completion indicators  
**Files to Create:** `components/education/ProgressBadge.tsx`, `components/education/ProgressDashboard.tsx`  
**Estimated Time:** 15 minutes

## Overview

Create visual badge components that show completion status for modules and overall certification progress. Display these on the user's profile and education dashboard.

## Pre-Substep Checklist

- [ ] **Completed:** Step 3.2.3 - Education context integration
- [ ] **Database:** `user_progress` table tracking completions
- [ ] **UI Library:** shadcn/ui Badge and Card components available
- [ ] **Icons:** lucide-react installed

## Implementation

### Goal

Build reusable badge and dashboard components that visualize learning progress and motivate continued education.

### Step-by-Step Instructions

#### Step 1: Create Progress Badge Component

- [ ] Create `components/education/ProgressBadge.tsx`:

```typescript
import { Badge } from '@/components/ui/badge'
import { CheckCircle2, Circle, Lock } from 'lucide-react'
import { cn } from '@/lib/utils'

interface ProgressBadgeProps {
  module: string
  completed: boolean
  locked?: boolean
  size?: 'sm' | 'md' | 'lg'
  showLabel?: boolean
}

export function ProgressBadge({
  module,
  completed,
  locked = false,
  size = 'md',
  showLabel = true,
}: ProgressBadgeProps) {
  const sizeClasses = {
    sm: 'w-8 h-8',
    md: 'w-12 h-12',
    lg: 'w-16 h-16',
  }

  const iconSizes = {
    sm: 'w-4 h-4',
    md: 'w-6 h-6',
    lg: 'w-8 h-8',
  }

  return (
    <div className="flex flex-col items-center gap-2">
      <div
        className={cn(
          'rounded-full border-2 flex items-center justify-center transition-all',
          sizeClasses[size],
          completed
            ? 'bg-green-100 border-green-500 text-green-700'
            : locked
            ? 'bg-gray-100 border-gray-300 text-gray-400'
            : 'bg-blue-50 border-blue-300 text-blue-600'
        )}
      >
        {locked ? (
          <Lock className={iconSizes[size]} />
        ) : completed ? (
          <CheckCircle2 className={iconSizes[size]} />
        ) : (
          <Circle className={iconSizes[size]} />
        )}
      </div>
      {showLabel && (
        <span
          className={cn(
            'text-xs font-medium text-center',
            locked ? 'text-gray-400' : 'text-gray-700'
          )}
        >
          {module}
        </span>
      )}
    </div>
  )
}
```

#### Step 2: Create Progress Dashboard Component

- [ ] Create `components/education/ProgressDashboard.tsx`:

```typescript
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Progress } from '@/components/ui/progress'
import { Badge } from '@/components/ui/badge'
import { ProgressBadge } from './ProgressBadge'
import { Trophy, Clock, Target } from 'lucide-react'

interface ModuleProgress {
  id: string
  name: string
  completed: boolean
  locked: boolean
}

interface ProgressDashboardProps {
  certification: 'OW' | 'AOW'
  modules: ModuleProgress[]
  overallProgress: number
  totalHoursSpent: number
  certificateEarned: boolean
}

export function ProgressDashboard({
  certification,
  modules,
  overallProgress,
  totalHoursSpent,
  certificateEarned,
}: ProgressDashboardProps) {
  const completedCount = modules.filter((m) => m.completed).length

  return (
    <Card>
      <CardHeader>
        <div className="flex items-center justify-between">
          <div>
            <CardTitle className="text-2xl">
              {certification === 'OW' ? 'Open Water Diver' : 'Advanced Open Water'}
            </CardTitle>
            <CardDescription>Your learning progress</CardDescription>
          </div>
          {certificateEarned && (
            <Badge className="bg-yellow-100 text-yellow-800 border-yellow-300">
              <Trophy className="w-4 h-4 mr-1" />
              Certified
            </Badge>
          )}
        </div>
      </CardHeader>

      <CardContent className="space-y-6">
        {/* Overall Progress */}
        <div>
          <div className="flex justify-between text-sm mb-2">
            <span className="font-medium">Overall Progress</span>
            <span className="text-muted-foreground">
              {completedCount} of {modules.length} modules
            </span>
          </div>
          <Progress value={overallProgress} className="h-3" />
          <p className="text-2xl font-bold text-blue-600 mt-2">{overallProgress}%</p>
        </div>

        {/* Module Badges */}
        <div>
          <h3 className="text-sm font-medium mb-4">Module Completion</h3>
          <div className="flex flex-wrap gap-6">
            {modules.map((module) => (
              <ProgressBadge
                key={module.id}
                module={module.name}
                completed={module.completed}
                locked={module.locked}
                size="md"
                showLabel={true}
              />
            ))}
          </div>
        </div>

        {/* Stats */}
        <div className="grid grid-cols-2 gap-4 pt-4">
          <div className="flex items-center gap-3 p-3 bg-blue-50 rounded-lg">
            <Clock className="w-5 h-5 text-blue-600" />
            <div>
              <p className="text-sm text-muted-foreground">Time Invested</p>
              <p className="text-lg font-semibold">{totalHoursSpent}h</p>
            </div>
          </div>

          <div className="flex items-center gap-3 p-3 bg-green-50 rounded-lg">
            <Target className="w-5 h-5 text-green-600" />
            <div>
              <p className="text-sm text-muted-foreground">Completed</p>
              <p className="text-lg font-semibold">
                {completedCount}/{modules.length}
              </p>
            </div>
          </div>
        </div>
      </CardContent>
    </Card>
  )
}
```

#### Step 3: Add Progress Dashboard to Profile Page

- [ ] Create or update `app/profile/page.tsx`:

```typescript
import { createServerClient } from '@/lib/supabase/server'
import { redirect } from 'next/navigation'
import { ProgressDashboard } from '@/components/education/ProgressDashboard'
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { Avatar, AvatarFallback } from '@/components/ui/avatar'
import { User } from 'lucide-react'

async function getUserProgress(userId: string) {
  const supabase = createServerClient()

  // Fetch all progress
  const { data: progress } = await supabase
    .from('user_progress')
    .select('*')
    .eq('user_id', userId)

  const owProgress = progress?.filter((p) => p.certification === 'OW') || []
  const aowProgress = progress?.filter((p) => p.certification === 'AOW') || []

  // Module definitions (hardcoded for demo - could be from database)
  const owModules = [
    { id: 'module-1', name: 'Module 1', completed: false, locked: false },
    { id: 'module-2', name: 'Module 2', completed: false, locked: false },
    { id: 'module-3', name: 'Module 3', completed: false, locked: false },
    { id: 'module-4', name: 'Module 4', completed: false, locked: false },
    { id: 'module-5', name: 'Module 5', completed: false, locked: false },
  ]

  const aowModules = [
    { id: 'deep', name: 'Deep Diving', completed: false, locked: false },
    { id: 'nav', name: 'Navigation', completed: false, locked: false },
    { id: 'night', name: 'Night Diving', completed: false, locked: false },
    { id: 'wreck', name: 'Wreck Diving', completed: false, locked: false },
    { id: 'photo', name: 'Photography', completed: false, locked: false },
  ]

  // Mark completed modules
  owProgress.forEach((p) => {
    const module = owModules.find((m) => p.topic_id.includes(m.id))
    if (module) module.completed = p.completed
  })

  aowProgress.forEach((p) => {
    const module = aowModules.find((m) => p.topic_id.includes(m.id))
    if (module) module.completed = p.completed
  })

  return {
    ow: {
      modules: owModules,
      progress: Math.round((owModules.filter((m) => m.completed).length / 5) * 100),
      certified: owModules.every((m) => m.completed),
    },
    aow: {
      modules: aowModules,
      progress: Math.round((aowModules.filter((m) => m.completed).length / 5) * 100),
      certified: aowModules.every((m) => m.completed),
    },
  }
}

export default async function ProfilePage() {
  const supabase = createServerClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    redirect('/auth/login?redirect=/profile')
  }

  const progress = await getUserProgress(user.id)

  return (
    <div className="min-h-screen bg-gray-50 py-8">
      <div className="container mx-auto px-4 max-w-4xl space-y-6">
        {/* Profile Header */}
        <Card>
          <CardContent className="pt-6">
            <div className="flex items-center gap-4">
              <Avatar className="w-16 h-16">
                <AvatarFallback>
                  <User className="w-8 h-8" />
                </AvatarFallback>
              </Avatar>
              <div>
                <h1 className="text-2xl font-bold">{user.email}</h1>
                <p className="text-muted-foreground">DovvyBuddy Student</p>
              </div>
            </div>
          </CardContent>
        </Card>

        {/* OW Progress */}
        <ProgressDashboard
          certification="OW"
          modules={progress.ow.modules}
          overallProgress={progress.ow.progress}
          totalHoursSpent={8} // Could be calculated from reading times
          certificateEarned={progress.ow.certified}
        />

        {/* AOW Progress */}
        <ProgressDashboard
          certification="AOW"
          modules={progress.aow.modules}
          overallProgress={progress.aow.progress}
          totalHoursSpent={4}
          certificateEarned={progress.aow.certified}
        />
      </div>
    </div>
  )
}
```

#### Step 4: Add Profile Link to Navigation

- [ ] Update `components/layout/Header.tsx`:

```typescript
<nav className="flex items-center gap-6">
  <Link href="/" className="text-sm font-medium">
    Home
  </Link>
  <Link href="/learn" className="text-sm font-medium">
    Learn
  </Link>
  <Link href="/chat" className="text-sm font-medium">
    Chat
  </Link>
  <Link href="/profile" className="text-sm font-medium">
    Profile
  </Link>
</nav>
```

## Verification Checklist

- [ ] Component created: `components/education/ProgressBadge.tsx`
- [ ] Component created: `components/education/ProgressDashboard.tsx`
- [ ] Page created: `app/profile/page.tsx`
- [ ] Profile link added to navigation
- [ ] Badges render with correct states (completed, in-progress, locked)
- [ ] Progress percentages calculate correctly
- [ ] Certificate badge shows when all modules complete
- [ ] Responsive design works on mobile

## Testing

1. **View profile page:**
   ```
   http://localhost:3000/profile
   ```
   - Should show two progress dashboards (OW and AOW)
   - Initially all badges should be incomplete

2. **Test progress tracking:**
   ```sql
   -- Mark a module complete
   INSERT INTO user_progress (user_id, topic_id, certification, completed)
   VALUES ('your-user-id', 'ow-module-1-topic', 'OW', true);
   ```
   - Refresh profile → Module 1 badge should be green with checkmark
   - Progress bar should update

3. **Test completion:**
   - Complete all 5 OW modules in database
   - Profile should show "Certified" badge with trophy icon
   - Progress should show 100%

4. **Test responsive design:**
   - View on mobile → badges should wrap appropriately
   - Cards should stack vertically on narrow screens

## Troubleshooting

| Issue | Solution |
|-------|----------|
| Badges not showing | Verify `lucide-react` installed; check imports |
| Progress always 0% | Check `user_progress` query returns data; verify userId matches |
| Certificate badge not appearing | Ensure all modules marked completed; check `certificateEarned` logic |
| Profile page 404 | Create `app/profile/page.tsx` file in correct location |
| Navigation link missing | Update Header component with Profile link |
| Module names not matching | Adjust hardcoded module definitions to match actual topic IDs |
| Colors not rendering | Ensure Tailwind classes like `bg-green-100` are not purged |

## Files Modified

- [ ] ✅ Created: `components/education/ProgressBadge.tsx`
- [ ] ✅ Created: `components/education/ProgressDashboard.tsx`
- [ ] ✅ Created: `app/profile/page.tsx`
- [ ] ✅ Modified: `components/layout/Header.tsx` (added Profile link)

## What Comes Next

**Next PR:** PR 3.3 - Quiz System & Knowledge Validation

Build interactive quizzes that test comprehension after completing modules, with instant feedback and explanations.
