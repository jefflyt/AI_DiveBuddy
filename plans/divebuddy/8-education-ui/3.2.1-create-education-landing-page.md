# Step 3.2.1: Create Education Landing Page

**Part of:** PR 3.2 - Education Mode & Topic Navigation  
**Focus:** Build learning dashboard for OW/AOW certification paths  
**Files to Create:** `app/learn/page.tsx`, `components/education/CertificationCard.tsx`  
**Estimated Time:** 20 minutes

## Overview

Create the main education landing page that presents OW and AOW certification paths as cards. Each card shows progress, estimated completion time, and starts the learning journey.

## Pre-Substep Checklist

- [ ] **Completed:** PR 3.1 - Education content seeded in database
- [ ] **Verified:** shadcn/ui installed with Card, Progress, Badge components
- [ ] **Auth working:** User can sign in and session is available
- [ ] **Database schema:** Has `user_progress` table for tracking learning

## Implementation

### Goal

Build a visually appealing education dashboard that lets users choose between Open Water and Advanced Open Water certification paths.

### Step-by-Step Instructions

#### Step 1: Create CertificationCard Component

- [ ] Create `components/education/CertificationCard.tsx`:

```typescript
'use client'

import Link from 'next/link'
import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Badge } from '@/components/ui/badge'
import { Progress } from '@/components/ui/progress'
import { BookOpen, Clock, Award, CheckCircle2 } from 'lucide-react'

interface CertificationCardProps {
  certification: 'OW' | 'AOW'
  title: string
  description: string
  moduleCount: number
  estimatedHours: number
  progress: number // 0-100
  isCompleted: boolean
  isLocked: boolean
}

export function CertificationCard({
  certification,
  title,
  description,
  moduleCount,
  estimatedHours,
  progress,
  isCompleted,
  isLocked,
}: CertificationCardProps) {
  const colors = {
    OW: {
      badge: 'bg-blue-100 text-blue-800 border-blue-200',
      button: 'bg-blue-600 hover:bg-blue-700',
      progress: 'bg-blue-500',
    },
    AOW: {
      badge: 'bg-purple-100 text-purple-800 border-purple-200',
      button: 'bg-purple-600 hover:bg-purple-700',
      progress: 'bg-purple-500',
    },
  }

  const theme = colors[certification]

  return (
    <Card className={`hover:shadow-lg transition-shadow ${isLocked ? 'opacity-60' : ''}`}>
      <CardHeader>
        <div className="flex items-center justify-between">
          <Badge variant="outline" className={theme.badge}>
            {certification}
          </Badge>
          {isCompleted && (
            <Badge variant="outline" className="bg-green-100 text-green-800 border-green-200">
              <CheckCircle2 className="w-3 h-3 mr-1" />
              Completed
            </Badge>
          )}
          {isLocked && (
            <Badge variant="outline" className="bg-gray-100 text-gray-600 border-gray-200">
              Locked
            </Badge>
          )}
        </div>
        <CardTitle className="text-2xl mt-2">{title}</CardTitle>
        <CardDescription>{description}</CardDescription>
      </CardHeader>

      <CardContent className="space-y-4">
        {/* Progress Bar */}
        {!isLocked && progress > 0 && (
          <div className="space-y-2">
            <div className="flex justify-between text-sm">
              <span className="text-muted-foreground">Progress</span>
              <span className="font-medium">{progress}%</span>
            </div>
            <Progress value={progress} className={`h-2`} />
          </div>
        )}

        {/* Stats */}
        <div className="flex gap-4 text-sm">
          <div className="flex items-center gap-1.5 text-muted-foreground">
            <BookOpen className="w-4 h-4" />
            <span>{moduleCount} modules</span>
          </div>
          <div className="flex items-center gap-1.5 text-muted-foreground">
            <Clock className="w-4 h-4" />
            <span>~{estimatedHours}h</span>
          </div>
        </div>

        {isLocked && (
          <p className="text-sm text-muted-foreground italic">
            Complete Open Water certification to unlock
          </p>
        )}
      </CardContent>

      <CardFooter>
        <Button
          asChild
          className={`w-full ${theme.button}`}
          disabled={isLocked}
        >
          <Link href={`/learn/${certification.toLowerCase()}`}>
            {isCompleted ? (
              <>
                <Award className="w-4 h-4 mr-2" />
                Review Course
              </>
            ) : progress > 0 ? (
              <>Continue Learning</>
            ) : (
              <>Start Learning</>
            )}
          </Link>
        </Button>
      </CardFooter>
    </Card>
  )
}
```

#### Step 2: Create Education Landing Page

- [ ] Create `app/learn/page.tsx`:

```typescript
import { createServerClient } from '@/lib/supabase/server'
import { redirect } from 'next/navigation'
import { CertificationCard } from '@/components/education/CertificationCard'
import { BookOpen, GraduationCap, Sparkles } from 'lucide-react'

export const metadata = {
  title: 'Learn to Dive | DiveBuddy',
  description: 'Master diving through OW and AOW certifications with AI-powered learning',
}

async function getUserProgress(userId: string) {
  const supabase = createServerClient()

  // Get user's progress across all education topics
  const { data: progress, error } = await supabase
    .from('user_progress')
    .select('topic_id, completed, certification')
    .eq('user_id', userId)

  if (error) {
    console.error('Error fetching progress:', error)
    return { ow: 0, aow: 0, owCompleted: false, aowCompleted: false }
  }

  // Calculate progress percentages
  const owProgress = progress?.filter(p => p.certification === 'OW') || []
  const aowProgress = progress?.filter(p => p.certification === 'AOW') || []

  // Assume 5 modules each for OW/AOW
  const owPercentage = Math.round((owProgress.filter(p => p.completed).length / 5) * 100)
  const aowPercentage = Math.round((aowProgress.filter(p => p.completed).length / 5) * 100)

  return {
    ow: owPercentage,
    aow: aowPercentage,
    owCompleted: owPercentage === 100,
    aowCompleted: aowPercentage === 100,
  }
}

export default async function LearnPage() {
  const supabase = createServerClient()

  const {
    data: { user },
  } = await supabase.auth.getUser()

  if (!user) {
    redirect('/auth/login?redirect=/learn')
  }

  const progress = await getUserProgress(user.id)

  return (
    <div className="min-h-screen bg-gradient-to-b from-blue-50 to-white">
      {/* Header */}
      <div className="container mx-auto px-4 pt-16 pb-8">
        <div className="max-w-3xl mx-auto text-center space-y-4">
          <div className="flex justify-center">
            <div className="p-3 bg-blue-100 rounded-full">
              <GraduationCap className="w-10 h-10 text-blue-600" />
            </div>
          </div>
          <h1 className="text-4xl font-bold tracking-tight">
            Learn to Dive with AI
          </h1>
          <p className="text-xl text-muted-foreground">
            Master diving skills through structured courses powered by intelligent tutoring
          </p>

          {/* Quick Stats */}
          <div className="flex justify-center gap-8 pt-4">
            <div className="text-center">
              <div className="text-3xl font-bold text-blue-600">
                {progress.ow + progress.aow > 0 
                  ? Math.round((progress.ow + progress.aow) / 2)
                  : 0}%
              </div>
              <div className="text-sm text-muted-foreground">Overall Progress</div>
            </div>
            <div className="text-center">
              <div className="text-3xl font-bold text-blue-600">
                {(progress.owCompleted ? 1 : 0) + (progress.aowCompleted ? 1 : 0)}/2
              </div>
              <div className="text-sm text-muted-foreground">Certifications</div>
            </div>
          </div>
        </div>
      </div>

      {/* Certification Cards */}
      <div className="container mx-auto px-4 pb-16">
        <div className="max-w-5xl mx-auto grid md:grid-cols-2 gap-6">
          <CertificationCard
            certification="OW"
            title="Open Water Diver"
            description="Master fundamental diving skills, equipment, and safety procedures for recreational diving up to 18 meters."
            moduleCount={5}
            estimatedHours={8}
            progress={progress.ow}
            isCompleted={progress.owCompleted}
            isLocked={false}
          />

          <CertificationCard
            certification="AOW"
            title="Advanced Open Water"
            description="Expand your skills with deep diving, navigation, and specialty techniques for dives up to 30 meters."
            moduleCount={5}
            estimatedHours={6}
            progress={progress.aow}
            isCompleted={progress.aowCompleted}
            isLocked={!progress.owCompleted}
          />
        </div>

        {/* How it Works */}
        <div className="max-w-5xl mx-auto mt-16 p-8 bg-white rounded-lg border">
          <div className="flex items-center gap-2 mb-6">
            <Sparkles className="w-5 h-5 text-blue-600" />
            <h2 className="text-2xl font-semibold">How AI-Powered Learning Works</h2>
          </div>

          <div className="grid md:grid-cols-3 gap-6">
            <div className="space-y-2">
              <div className="w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-bold">
                1
              </div>
              <h3 className="font-semibold">Read & Learn</h3>
              <p className="text-sm text-muted-foreground">
                Study comprehensive modules covering all certification requirements
              </p>
            </div>

            <div className="space-y-2">
              <div className="w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-bold">
                2
              </div>
              <h3 className="font-semibold">Chat with AI</h3>
              <p className="text-sm text-muted-foreground">
                Ask questions and get instant, context-aware answers from your AI tutor
              </p>
            </div>

            <div className="space-y-2">
              <div className="w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-bold">
                3
              </div>
              <h3 className="font-semibold">Test Knowledge</h3>
              <p className="text-sm text-muted-foreground">
                Complete quizzes to validate understanding and track your progress
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  )
}
```

#### Step 3: Update Navigation

- [ ] Add education link to main nav in `components/layout/Header.tsx`:

```typescript
<nav className="flex items-center gap-6">
  <Link href="/" className="text-sm font-medium">
    Home
  </Link>
  <Link href="/learn" className="text-sm font-medium">
    Learn
  </Link>
  <Link href="/chat" className="text-sm font-medium">
    Chat
  </Link>
</nav>
```

#### Step 4: Create Placeholder Module Pages

- [ ] Create `app/learn/ow/page.tsx`:

```typescript
import { redirect } from 'next/navigation'

export default function OWPage() {
  // For now, redirect to first module - we'll build full browse UI in next substep
  redirect('/learn/ow/module-1')
}
```

- [ ] Create `app/learn/aow/page.tsx`:

```typescript
import { redirect } from 'next/navigation'

export default function AOWPage() {
  redirect('/learn/aow/deep-diving')
}
```

## Verification Checklist

- [ ] Component created: `components/education/CertificationCard.tsx`
- [ ] Page created: `app/learn/page.tsx`
- [ ] Navigation updated with "Learn" link
- [ ] Placeholder redirect pages created for OW/AOW
- [ ] Page renders without errors
- [ ] OW card shows "Start Learning" button
- [ ] AOW card shows "Locked" if OW not completed
- [ ] Progress bars display correctly (if progress exists)
- [ ] Responsive design works on mobile

## Testing

Test the education landing page:

1. **Navigate to education page:**
   ```
   http://localhost:3000/learn
   ```

2. **Verify UI elements:**
   - Header with graduation cap icon
   - Two certification cards (OW and AOW)
   - Progress stats at top
   - "How it Works" section at bottom

3. **Test authentication:**
   - Sign out → should redirect to login
   - Sign in → should show personalized progress

4. **Test interactions:**
   - Click "Start Learning" on OW card → redirects to `/learn/ow`
   - AOW card should be locked initially

5. **Test progress (manual database insert):**
   ```sql
   -- In Supabase SQL Editor
   INSERT INTO user_progress (user_id, topic_id, certification, completed)
   VALUES 
     ('your-user-id', 'ow-module-1', 'OW', true),
     ('your-user-id', 'ow-module-2', 'OW', false);
   ```
   Refresh page → OW should show 20% progress

## Troubleshooting

| Issue | Solution |
|-------|----------|
| "Learn" link doesn't appear in nav | Update `components/layout/Header.tsx` with navigation items |
| Auth redirect loop | Check Supabase auth setup; ensure middleware allows `/learn` route |
| Progress always shows 0% | Verify `user_progress` table exists and has RLS policies allowing reads |
| Cards not rendering | Check shadcn/ui Card component installed: `npx shadcn-ui@latest add card` |
| TypeScript errors on icons | Install lucide-react: `npm install lucide-react` |
| AOW not locked | Check progress calculation logic in `getUserProgress` |
| Gradient background not showing | Ensure Tailwind CSS is configured with `from-blue-50 to-white` |

## Files Modified

- [ ] ✅ Created: `components/education/CertificationCard.tsx`
- [ ] ✅ Created: `app/learn/page.tsx`
- [ ] ✅ Created: `app/learn/ow/page.tsx`
- [ ] ✅ Created: `app/learn/aow/page.tsx`
- [ ] ✅ Modified: `components/layout/Header.tsx` (added Learn nav link)

## What Comes Next

**Next Substep:** 3.2.2 - Create Topic Browse & Detail Pages

Build the module navigation and individual topic pages that display markdown content with AI chat integration.
