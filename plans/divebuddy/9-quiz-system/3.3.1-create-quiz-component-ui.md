# Step 3.3.1: Create Quiz Component UI

**Part of:** PR 3.3 - Quiz System & Knowledge Validation  
**Focus:** Build interactive quiz component with question types  
**Files to Create:** `components/quiz/QuizQuestion.tsx`, `components/quiz/QuizResults.tsx`  
**Estimated Time:** 25 minutes

## Overview

Create reusable quiz UI components that support multiple-choice questions, instant feedback, explanations, and scoring. These will be embedded at the end of education topics.

## Pre-Substep Checklist

- [ ] **Completed:** PR 3.2 - Education UI with topic pages
- [ ] **Content ready:** Quiz questions exist in topic markdown frontmatter
- [ ] **shadcn/ui:** Button, Card, RadioGroup components installed
- [ ] **State management:** React hooks available

## Implementation

### Goal

Build a self-contained quiz experience that tests knowledge, provides feedback, and tracks results.

### Step-by-Step Instructions

#### Step 1: Create Quiz Question Component

- [ ] Create `components/quiz/QuizQuestion.tsx`:

```typescript
'use client'

import { useState } from 'react'
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group'
import { Label } from '@/components/ui/label'
import { CheckCircle2, XCircle, AlertCircle } from 'lucide-react'
import { cn } from '@/lib/utils'

export interface QuizQuestionData {
  id: string
  question: string
  options: string[]
  correctAnswer: number // Index of correct option
  explanation: string
}

interface QuizQuestionProps {
  data: QuizQuestionData
  questionNumber: number
  onAnswer: (questionId: string, selectedAnswer: number, isCorrect: boolean) => void
  answered: boolean
}

export function QuizQuestion({
  data,
  questionNumber,
  onAnswer,
  answered,
}: QuizQuestionProps) {
  const [selectedAnswer, setSelectedAnswer] = useState<number | null>(null)
  const [showFeedback, setShowFeedback] = useState(false)

  const handleSubmit = () => {
    if (selectedAnswer === null) return

    const isCorrect = selectedAnswer === data.correctAnswer
    setShowFeedback(true)
    onAnswer(data.id, selectedAnswer, isCorrect)
  }

  const isCorrect = selectedAnswer === data.correctAnswer

  return (
    <Card className={cn(
      'transition-all',
      showFeedback && (isCorrect ? 'border-green-300 bg-green-50/30' : 'border-red-300 bg-red-50/30')
    )}>
      <CardHeader>
        <div className="flex items-start justify-between">
          <CardTitle className="text-lg">
            Question {questionNumber}
          </CardTitle>
          {showFeedback && (
            <div className={cn(
              'flex items-center gap-1.5 text-sm font-medium',
              isCorrect ? 'text-green-700' : 'text-red-700'
            )}>
              {isCorrect ? (
                <>
                  <CheckCircle2 className="w-5 h-5" />
                  Correct!
                </>
              ) : (
                <>
                  <XCircle className="w-5 h-5" />
                  Incorrect
                </>
              )}
            </div>
          )}
        </div>
      </CardHeader>

      <CardContent className="space-y-4">
        {/* Question Text */}
        <p className="text-base font-medium leading-relaxed">
          {data.question}
        </p>

        {/* Answer Options */}
        <RadioGroup
          value={selectedAnswer?.toString() || ''}
          onValueChange={(value) => {
            if (!showFeedback) {
              setSelectedAnswer(parseInt(value))
            }
          }}
          disabled={showFeedback}
          className="space-y-3"
        >
          {data.options.map((option, index) => (
            <div
              key={index}
              className={cn(
                'flex items-start space-x-3 p-3 rounded-lg border transition-all',
                showFeedback && index === data.correctAnswer
                  ? 'bg-green-100 border-green-400'
                  : showFeedback && index === selectedAnswer && !isCorrect
                  ? 'bg-red-100 border-red-400'
                  : 'bg-white hover:bg-gray-50',
                !showFeedback && 'cursor-pointer'
              )}
            >
              <RadioGroupItem
                value={index.toString()}
                id={`${data.id}-option-${index}`}
                disabled={showFeedback}
                className="mt-0.5"
              />
              <Label
                htmlFor={`${data.id}-option-${index}`}
                className={cn(
                  'flex-1 cursor-pointer',
                  showFeedback && 'cursor-default'
                )}
              >
                {option}
              </Label>
              {showFeedback && index === data.correctAnswer && (
                <CheckCircle2 className="w-5 h-5 text-green-600 flex-shrink-0" />
              )}
              {showFeedback && index === selectedAnswer && !isCorrect && (
                <XCircle className="w-5 h-5 text-red-600 flex-shrink-0" />
              )}
            </div>
          ))}
        </RadioGroup>

        {/* Submit Button */}
        {!showFeedback && (
          <Button
            onClick={handleSubmit}
            disabled={selectedAnswer === null}
            className="w-full"
          >
            Submit Answer
          </Button>
        )}

        {/* Explanation */}
        {showFeedback && (
          <div className="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
            <div className="flex items-start gap-2">
              <AlertCircle className="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5" />
              <div>
                <p className="font-medium text-blue-900 mb-1">Explanation</p>
                <p className="text-sm text-blue-800 leading-relaxed">
                  {data.explanation}
                </p>
              </div>
            </div>
          </div>
        )}
      </CardContent>
    </Card>
  )
}
```

#### Step 2: Create Quiz Results Component

- [ ] Create `components/quiz/QuizResults.tsx`:

```typescript
'use client'

import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Progress } from '@/components/ui/progress'
import { Trophy, RotateCcw, CheckCircle2, XCircle } from 'lucide-react'
import { cn } from '@/lib/utils'

interface QuizResultsProps {
  totalQuestions: number
  correctAnswers: number
  onRetake: () => void
  onComplete: () => void
}

export function QuizResults({
  totalQuestions,
  correctAnswers,
  onRetake,
  onComplete,
}: QuizResultsProps) {
  const percentage = Math.round((correctAnswers / totalQuestions) * 100)
  const passed = percentage >= 70 // 70% passing grade

  return (
    <Card className={cn(
      'border-2',
      passed ? 'border-green-300 bg-green-50/30' : 'border-yellow-300 bg-yellow-50/30'
    )}>
      <CardHeader>
        <div className="text-center space-y-2">
          <div className="flex justify-center">
            {passed ? (
              <div className="p-4 bg-green-100 rounded-full">
                <Trophy className="w-12 h-12 text-green-600" />
              </div>
            ) : (
              <div className="p-4 bg-yellow-100 rounded-full">
                <RotateCcw className="w-12 h-12 text-yellow-600" />
              </div>
            )}
          </div>
          <CardTitle className="text-2xl">
            {passed ? 'Congratulations!' : 'Keep Practicing'}
          </CardTitle>
          <p className="text-muted-foreground">
            {passed
              ? 'You passed the quiz with flying colors!'
              : 'Review the material and try again.'}
          </p>
        </div>
      </CardHeader>

      <CardContent className="space-y-6">
        {/* Score Display */}
        <div className="text-center">
          <div className="text-5xl font-bold text-blue-600 mb-2">
            {percentage}%
          </div>
          <p className="text-muted-foreground">
            {correctAnswers} out of {totalQuestions} correct
          </p>
        </div>

        {/* Progress Bar */}
        <div>
          <Progress
            value={percentage}
            className={cn(
              'h-4',
              passed ? '[&>div]:bg-green-500' : '[&>div]:bg-yellow-500'
            )}
          />
        </div>

        {/* Stats */}
        <div className="grid grid-cols-2 gap-4">
          <div className="p-4 bg-white rounded-lg border text-center">
            <div className="flex items-center justify-center gap-2 text-green-600 mb-1">
              <CheckCircle2 className="w-5 h-5" />
              <span className="text-2xl font-bold">{correctAnswers}</span>
            </div>
            <p className="text-sm text-muted-foreground">Correct</p>
          </div>

          <div className="p-4 bg-white rounded-lg border text-center">
            <div className="flex items-center justify-center gap-2 text-red-600 mb-1">
              <XCircle className="w-5 h-5" />
              <span className="text-2xl font-bold">
                {totalQuestions - correctAnswers}
              </span>
            </div>
            <p className="text-sm text-muted-foreground">Incorrect</p>
          </div>
        </div>

        {/* Actions */}
        <div className="flex flex-col sm:flex-row gap-3">
          <Button
            onClick={onRetake}
            variant="outline"
            className="flex-1"
          >
            <RotateCcw className="w-4 h-4 mr-2" />
            Retake Quiz
          </Button>
          {passed && (
            <Button
              onClick={onComplete}
              className="flex-1 bg-green-600 hover:bg-green-700"
            >
              <Trophy className="w-4 h-4 mr-2" />
              Complete Topic
            </Button>
          )}
        </div>

        {!passed && (
          <p className="text-sm text-center text-muted-foreground italic">
            You need 70% or higher to complete this topic
          </p>
        )}
      </CardContent>
    </Card>
  )
}
```

#### Step 3: Create Quiz Container Component

- [ ] Create `components/quiz/Quiz.tsx`:

```typescript
'use client'

import { useState } from 'react'
import { QuizQuestion, QuizQuestionData } from './QuizQuestion'
import { QuizResults } from './QuizResults'
import { Button } from '@/components/ui/button'
import { Progress } from '@/components/ui/progress'
import { ChevronRight } from 'lucide-react'

interface QuizProps {
  questions: QuizQuestionData[]
  topicId: string
  onComplete: () => void
}

interface AnswerRecord {
  questionId: string
  selectedAnswer: number
  isCorrect: boolean
}

export function Quiz({ questions, topicId, onComplete }: QuizProps) {
  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0)
  const [answers, setAnswers] = useState<AnswerRecord[]>([])
  const [showResults, setShowResults] = useState(false)

  const currentQuestion = questions[currentQuestionIndex]
  const progress = ((currentQuestionIndex + 1) / questions.length) * 100

  const handleAnswer = (questionId: string, selectedAnswer: number, isCorrect: boolean) => {
    // Record answer
    setAnswers([...answers, { questionId, selectedAnswer, isCorrect }])
  }

  const handleNext = () => {
    if (currentQuestionIndex < questions.length - 1) {
      setCurrentQuestionIndex(currentQuestionIndex + 1)
    } else {
      setShowResults(true)
    }
  }

  const handleRetake = () => {
    setCurrentQuestionIndex(0)
    setAnswers([])
    setShowResults(false)
  }

  const correctCount = answers.filter((a) => a.isCorrect).length

  if (showResults) {
    return (
      <QuizResults
        totalQuestions={questions.length}
        correctAnswers={correctCount}
        onRetake={handleRetake}
        onComplete={onComplete}
      />
    )
  }

  const hasAnswered = answers.some((a) => a.questionId === currentQuestion.id)

  return (
    <div className="space-y-6">
      {/* Progress Header */}
      <div className="space-y-2">
        <div className="flex justify-between text-sm">
          <span className="font-medium">Quiz Progress</span>
          <span className="text-muted-foreground">
            {currentQuestionIndex + 1} of {questions.length}
          </span>
        </div>
        <Progress value={progress} className="h-2" />
      </div>

      {/* Question */}
      <QuizQuestion
        data={currentQuestion}
        questionNumber={currentQuestionIndex + 1}
        onAnswer={handleAnswer}
        answered={hasAnswered}
      />

      {/* Next Button */}
      {hasAnswered && (
        <div className="flex justify-end">
          <Button onClick={handleNext} size="lg">
            {currentQuestionIndex < questions.length - 1 ? (
              <>
                Next Question
                <ChevronRight className="w-4 h-4 ml-2" />
              </>
            ) : (
              <>View Results</>
            )}
          </Button>
        </div>
      )}
    </div>
  )
}
```

#### Step 4: Install Required UI Components

- [ ] Install missing shadcn/ui components:

```bash
npx shadcn-ui@latest add radio-group
npx shadcn-ui@latest add label
```

## Verification Checklist

- [ ] Component created: `components/quiz/QuizQuestion.tsx`
- [ ] Component created: `components/quiz/QuizResults.tsx`
- [ ] Component created: `components/quiz/Quiz.tsx`
- [ ] RadioGroup and Label components installed
- [ ] Quiz questions render with multiple choice options
- [ ] Submit button works and shows feedback
- [ ] Correct/incorrect answers highlighted appropriately
- [ ] Explanations display after submission
- [ ] Results screen shows score and pass/fail status
- [ ] Retake functionality resets quiz state

## Testing

Test quiz components in isolation:

1. **Create test page** `app/quiz-test/page.tsx`:

```typescript
'use client'

import { Quiz } from '@/components/quiz/Quiz'

const mockQuestions = [
  {
    id: 'q1',
    question: 'What is the maximum depth for Open Water divers?',
    options: ['12 meters', '18 meters', '30 meters', '40 meters'],
    correctAnswer: 1,
    explanation: 'Open Water divers are certified to dive up to 18 meters (60 feet).',
  },
  {
    id: 'q2',
    question: 'What does BCD stand for?',
    options: [
      'Buoyancy Control Device',
      'Basic Compression Depth',
      'Breathing Control Diaphragm',
      'Bottom Current Detector',
    ],
    correctAnswer: 0,
    explanation: 'BCD stands for Buoyancy Control Device, which helps divers maintain neutral buoyancy.',
  },
  {
    id: 'q3',
    question: 'How often should you equalize pressure in your ears during descent?',
    options: ['Once at the surface', 'Every 1-2 meters', 'Only if you feel pain', 'At maximum depth'],
    correctAnswer: 1,
    explanation: 'You should equalize early and often, typically every 1-2 meters during descent.',
  },
]

export default function QuizTestPage() {
  return (
    <div className="container mx-auto px-4 py-8 max-w-2xl">
      <h1 className="text-3xl font-bold mb-6">Quiz Test</h1>
      <Quiz
        questions={mockQuestions}
        topicId="test-topic"
        onComplete={() => alert('Quiz completed!')}
      />
    </div>
  )
}
```

2. **Test quiz flow:**
   - Navigate to `http://localhost:3000/quiz-test`
   - Answer questions and verify feedback
   - Complete quiz and check results screen
   - Click "Retake Quiz" and verify reset

## Troubleshooting

| Issue | Solution |
|-------|----------|
| RadioGroup not rendering | Install component: `npx shadcn-ui@latest add radio-group` |
| Label component missing | Install component: `npx shadcn-ui@latest add label` |
| Colors not applying | Check Tailwind config includes color utilities like `bg-green-100` |
| Submit button always disabled | Verify `selectedAnswer` state is updating on radio selection |
| Explanation not showing | Check `showFeedback` state is set to `true` after submission |
| Results not displaying | Verify `showResults` state triggers conditional rendering |
| "Complete Topic" button missing | Ensure percentage >= 70 and `passed` is `true` |

## Files Modified

- [ ] ✅ Created: `components/quiz/QuizQuestion.tsx`
- [ ] ✅ Created: `components/quiz/QuizResults.tsx`
- [ ] ✅ Created: `components/quiz/Quiz.tsx`
- [ ] ✅ Created: `app/quiz-test/page.tsx` (for testing only)

## What Comes Next

**Next Substep:** 3.3.2 - Create Quiz Progress Database Schema

Design and implement database tables for storing quiz attempts, scores, and tracking user performance over time.
