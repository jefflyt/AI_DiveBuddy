# Step 2.3.1: Install Google AI SDK and Dependencies

**Part of:** PR 2.3 - Google AI Agent Framework Integration  
**Focus:** Install @google/generative-ai and agent framework dependencies  
**Estimated Time:** 10 minutes

## Overview

Install the official Google Generative AI SDK and related dependencies needed for building the multi-agent system with tools, function calling, and session management.

## Pre-Step Checklist

- [ ] **Completed:** PR 2.2 - Vector embeddings and pgvector setup
- [ ] **Environment:** `GOOGLE_API_KEY` in `.env.local`
- [ ] **Terminal:** In project root directory

## Implementation

### Goal

Install Google Generative AI SDK and set up the foundation for agent framework implementation.

### Step-by-Step Instructions

#### Step 1: Install Google AI SDK

Install the official Gemini SDK and supporting packages:

```bash
npm install @google/generative-ai
npm install zod  # For structured tool parameters validation
npm install uuid  # For session ID generation
```

#### Step 2: Verify Google API Key

Ensure your `.env.local` has the Gemini API key:

```bash
# Google Gemini API (Phase 2, PR 2.1)
GOOGLE_API_KEY=your-actual-api-key-here
```

**To get your API key:**
1. Visit <https://aistudio.google.com/app/apikey>

2. Click "Create API Key"
3. Copy the key and paste into `.env.local`

#### Step 3: Create Google AI Client Utility

Create `src/lib/ai/gemini.ts`:

```typescript
import { GoogleGenerativeAI } from '@google/generative-ai'

if (!process.env.GOOGLE_API_KEY) {
  throw new Error('GOOGLE_API_KEY environment variable is not set')
}

// Initialize Google AI client
export const genAI = new GoogleGenerativeAI(process.env.GOOGLE_API_KEY)

// Model configurations
export const MODELS = {
  FLASH: 'gemini-1.5-flash-latest',
  PRO: 'gemini-1.5-pro-latest',
  EMBEDDING: 'text-embedding-004',
} as const

// Get chat model with default settings
export function getChatModel(temperature = 0.7) {
  return genAI.getGenerativeModel({
    model: MODELS.FLASH,
    generationConfig: {
      temperature,
      topP: 0.95,
      topK: 40,
      maxOutputTokens: 2048,
    },
  })
}

// Get embedding model
export function getEmbeddingModel() {
  return genAI.getGenerativeModel({
    model: MODELS.EMBEDDING,
  })
}
```

#### Step 4: Create Types for Agent Framework

Create `src/lib/agents/types.ts`:

```typescript
import { z } from 'zod'

// Session types
export interface Session {
  id: string
  userId?: string
  messages: Message[]
  context: Record<string, any>
  createdAt: Date
  updatedAt: Date
}

export interface Message {
  id: string
  sessionId: string
  role: 'user' | 'agent' | 'system'
  content: string
  metadata?: Record<string, any>
  timestamp: Date
}

// Agent types
export type AgentType = 'orchestrator' | 'education' | 'trip-planning'

export interface AgentConfig {
  name: string
  description: string
  instructions: string
  temperature?: number
  tools?: AgentTool[]
}

// Tool types
export interface AgentTool {
  name: string
  description: string
  parameters: z.ZodObject<any>
  execute: (params: any) => Promise<any>
}

// Intent classification
export const IntentSchema = z.enum(['education', 'trip-planning', 'general'])
export type Intent = z.infer<typeof IntentSchema>

// Tool execution result
export interface ToolResult {
  toolName: string
  result: any
  error?: string
}
```

#### Step 5: Verify Installation

Create a test file `src/lib/ai/__tests__/gemini.test.ts`:

```typescript
import { genAI, getChatModel, getEmbeddingModel, MODELS } from '../gemini'

describe('Gemini SDK', () => {
  it('should initialize Google AI client', () => {
    expect(genAI).toBeDefined()
  })

  it('should return chat model', () => {
    const model = getChatModel()
    expect(model).toBeDefined()
  })

  it('should return embedding model', () => {
    const model = getEmbeddingModel()
    expect(model).toBeDefined()
  })

  it('should use correct model names', () => {
    expect(MODELS.FLASH).toContain('gemini-1.5-flash')
    expect(MODELS.EMBEDDING).toBe('text-embedding-004')
  })
})
```

Run the test:

```bash
npm test -- gemini.test.ts
```

## Verification Checklist

- [ ] `@google/generative-ai` installed in `package.json`
- [ ] `zod` and `uuid` installed
- [ ] `src/lib/ai/gemini.ts` exists and exports models
- [ ] `src/lib/agents/types.ts` exists with type definitions
- [ ] `GOOGLE_API_KEY` set in `.env.local`
- [ ] Test passes confirming SDK initialized
- [ ] No TypeScript errors in created files

## Troubleshooting

| Issue | Solution |
|-------|----------|
| `GOOGLE_API_KEY is not set` error | Add valid API key to `.env.local` and restart dev server |
| Module not found errors | Run `npm install` to ensure all packages installed |
| TypeScript errors on Zod schemas | Ensure `zod` version is ^3.22.0 or higher |
| API key invalid | Verify key at <https://aistudio.google.com/app/apikey> |

## Files Created

- ✅ Created: `src/lib/ai/gemini.ts` - Google AI client utilities
- ✅ Created: `src/lib/agents/types.ts` - Agent framework type definitions
- ✅ Created: `src/lib/ai/__tests__/gemini.test.ts` - SDK verification tests

## What Comes Next

Next step: **2.3.2-create-vector-search-tool.md** - Build RAG vector search tool for agents
